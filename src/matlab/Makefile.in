
ifndef RP_INSTALL_BASE
RP_INSTALL_BASE = @prefix@
endif

# tell make where to find the expat & libscew sources
INCL_RP_DEPS    = -I$(RP_INSTALL_BASE)/include

LIB_SCEW_FLAG   = -L$(RP_INSTALL_BASE)/lib -lscew

# define the top of the rappture directory structure
RP_BASE   = @RP_BASE@

# define our compiling environment
#
MEX             = @MEX@ @MEX_ARCH@

# define our directories
#
INCLUDES_DIR    = $(RP_BASE)/src
LIB_DIR         = $(RP_BASE)/src
MATLAB_SRC      = $(RP_BASE)/matlab
LIB_RAPPTURE    = -L$(LIB_DIR) -lrappture
INCL_CORE       = -I$(INCLUDES_DIR)/core
INCL_CEE        = -I$(INCLUDES_DIR)/cee
INCL_MATLAB     = -I$(INCLUDES_DIR)/matlab

all: RpMatlab install_matlab
install: install_matlab

#### Matlab ########################################################
install_matlab: RpMatlab
	if test ! -d $(RP_INSTALL_BASE)/lib/matlab; then \
		mkdir $(RP_INSTALL_BASE)/lib/matlab; \
	fi
	cp *.mex* $(RP_INSTALL_BASE)/lib/matlab

####################################################################

# matlab bindings
MEX_INCLS = $(INCL_MATLAB) $(INCL_CORE) $(INCL_CEE) $(INCL_RP_DEPS)
# MEX_OPTS = -g -outdir $(MATLAB_SRC) -L$(LIB_DIR) -lrappture $(LIB_SCEW_FLAG)
MEX_OPTS = -g $(LIB_RAPPTURE) $(LIB_SCEW_FLAG)
MATLAB_COMP_ARGS = RpMatlabInterface.cc $(MEX_INCLS) $(MEX_OPTS)

RpMatlab: 	rpLib.mexglx \
			rpLibXml.mexglx \
			rpLibElement.mexglx \
			rpLibElementAsObject.mexglx \
			rpLibElementAsType.mexglx \
			rpLibElementAsComp.mexglx \
			rpLibElementAsId.mexglx \
			rpLibChildren.mexglx \
			rpLibChildrenByType.mexglx \
			rpLibGet.mexglx \
			rpLibGetString.mexglx \
			rpLibGetDouble.mexglx \
			rpLibPut.mexglx \
			rpLibPutString.mexglx \
			rpLibPutDouble.mexglx \
			rpLibNodeComp.mexglx \
			rpLibNodeType.mexglx \
			rpLibNodeId.mexglx \
			rpLibResult.mexglx \
			rpUnitsDefineUnit.mexglx \
			rpUnitsGetUnits.mexglx \
			rpUnitsGetUnitsName.mexglx \
			rpUnitsGetExponent.mexglx \
			rpUnitsGetBasis.mexglx \
			rpUnitsFind.mexglx \
			rpUnitsMakeMetric.mexglx \
			rpUnitsConvert.mexglx \
			rpUnitsConvertStr.mexglx \
			rpUnitsConvertObjStr.mexglx \
			rpUnitsConvertDbl.mexglx \
			rpUnitsConvertObjDbl.mexglx \
			rpAddPresets.mexglx



rpLib.mexglx:
	$(MEX) rpLib.cc                   $(MATLAB_COMP_ARGS)
rpLibXml.mexglx:
	$(MEX) rpLibXml.cc                $(MATLAB_COMP_ARGS)
rpLibElement.mexglx:
	$(MEX) rpLibElement.cc            $(MATLAB_COMP_ARGS)
rpLibElementAsObject.mexglx:
	$(MEX) rpLibElementAsObject.cc    $(MATLAB_COMP_ARGS)
rpLibElementAsType.mexglx:
	$(MEX) rpLibElementAsType.cc      $(MATLAB_COMP_ARGS)
rpLibElementAsComp.mexglx:
	$(MEX) rpLibElementAsComp.cc      $(MATLAB_COMP_ARGS)
rpLibElementAsId.mexglx:
	$(MEX) rpLibElementAsId.cc        $(MATLAB_COMP_ARGS)
rpLibChildren.mexglx:
	$(MEX) rpLibChildren.cc           $(MATLAB_COMP_ARGS)
rpLibChildrenByType.mexglx:
	$(MEX) rpLibChildrenByType.cc     $(MATLAB_COMP_ARGS)

#rpLibChildrenAsObject.mexglx:
#$(MEX) rpChildrenAsObject.cc         $(MATLAB_COMP_ARGS)
#rpLibChildrenAsType.mexglx:
#$(MEX) rpChildrenAsType.cc           $(MATLAB_COMP_ARGS)
#rpLibChildrenAsComp.mexglx:
#$(MEX) rpChildrenAsComp.cc           $(MATLAB_COMP_ARGS)
#rpLibChildrenAsId.mexglx:
#$(MEX) rpChildrenAsId.cc             $(MATLAB_COMP_ARGS)

rpLibGet.mexglx:
	$(MEX) rpLibGet.cc                $(MATLAB_COMP_ARGS)
rpLibGetString.mexglx:
	$(MEX) rpLibGetString.cc          $(MATLAB_COMP_ARGS)
rpLibGetDouble.mexglx:
	$(MEX) rpLibGetDouble.cc          $(MATLAB_COMP_ARGS)
rpLibPut.mexglx:
	$(MEX) rpLibPut.cc                $(MATLAB_COMP_ARGS)
rpLibPutString.mexglx:
	$(MEX) rpLibPutString.cc          $(MATLAB_COMP_ARGS)
rpLibPutDouble.mexglx:
	$(MEX) rpLibPutDouble.cc          $(MATLAB_COMP_ARGS)
rpLibNodeComp.mexglx:
	$(MEX) rpLibNodeComp.cc           $(MATLAB_COMP_ARGS)
rpLibNodeType.mexglx:
	$(MEX) rpLibNodeType.cc           $(MATLAB_COMP_ARGS)
rpLibNodeId.mexglx:
	$(MEX) rpLibNodeId.cc             $(MATLAB_COMP_ARGS)
rpLibResult.mexglx:
	$(MEX) rpLibResult.cc             $(MATLAB_COMP_ARGS)
rpUnitsDefineUnit.mexglx:
	$(MEX) rpUnitsDefineUnit.cc       $(MATLAB_COMP_ARGS)
#rpDefineConv.mexglx:
#$(MEX) rpDefineConv.cc               $(MATLAB_COMP_ARGS)
rpUnitsGetUnits.mexglx:
	$(MEX) rpUnitsGetUnits.cc         $(MATLAB_COMP_ARGS)
rpUnitsGetUnitsName.mexglx:
	$(MEX) rpUnitsGetUnitsName.cc     $(MATLAB_COMP_ARGS)
rpUnitsGetExponent.mexglx:
	$(MEX) rpUnitsGetExponent.cc      $(MATLAB_COMP_ARGS)
rpUnitsGetBasis.mexglx:
	$(MEX) rpUnitsGetBasis.cc         $(MATLAB_COMP_ARGS)
rpUnitsFind.mexglx:
	$(MEX) rpUnitsFind.cc             $(MATLAB_COMP_ARGS)
rpUnitsMakeMetric.mexglx:
	$(MEX) rpUnitsMakeMetric.cc       $(MATLAB_COMP_ARGS)
rpUnitsConvert.mexglx:
	$(MEX) rpUnitsConvert.cc          $(MATLAB_COMP_ARGS)
rpUnitsConvertStr.mexglx:
	$(MEX) rpUnitsConvertStr.cc       $(MATLAB_COMP_ARGS)
rpUnitsConvertObjStr.mexglx:
	$(MEX) rpUnitsConvertObjStr.cc    $(MATLAB_COMP_ARGS)
rpUnitsConvertDbl.mexglx:
	$(MEX) rpUnitsConvertDbl.cc       $(MATLAB_COMP_ARGS)
rpUnitsConvertObjDbl.mexglx:
	$(MEX) rpUnitsConvertObjDbl.cc    $(MATLAB_COMP_ARGS)
rpAddPresets.mexglx:
	$(MEX) rpAddPresets.cc            $(MATLAB_COMP_ARGS)

docs:
	if test ! -d docs; then \
		mkdir docs; \
	fi
	if test ! -d docs/doxygen; then \
		mkdir docs/doxygen; \
	fi
	doxygen

#### CLEAN UP ############################################################
clean: 
	- rm -f rp*.mex*

distclean: clean
	- rm Makefile
