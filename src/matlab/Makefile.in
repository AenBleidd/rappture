
ifndef RP_INSTALL_BASE
RP_INSTALL_BASE = @prefix@
endif

# tell make where to find the expat & libscew sources
INCL_RP_DEPS    = -I$(RP_INSTALL_BASE)/include

LIB_SCEW_FLAG   = -L$(RP_INSTALL_BASE)/lib -lscew

# define the top of the rappture directory structure
RP_BASE   = @RP_BASE@

# define our compiling environment
#
MEX             = @MEX@

# define our directories
#
INCLUDES_DIR    = $(RP_BASE)/include
LIB_DIR         = $(RP_BASE)/src
MATLAB_SRC      = $(RP_BASE)/matlab
LIB_RAPPTURE    = -L$(LIB_DIR) -lrappture
INCL_CORE       = -I$(INCLUDES_DIR)/core
INCL_CEE        = -I$(INCLUDES_DIR)/cee
INCL_MATLAB     = -I$(INCLUDES_DIR)/matlab

all: RpMatlab install_matlab
install: install_matlab

#### Matlab ########################################################
install_matlab: RpMatlab
	if test ! -d $(RP_INSTALL_BASE)/lib/matlab; then \
		mkdir $(RP_INSTALL_BASE)/lib/matlab; \
	fi
	cp *.mex* $(RP_INSTALL_BASE)/lib/matlab

####################################################################

# matlab bindings
MEX_INCLS = $(INCL_MATLAB) $(INCL_CORE) $(INCL_CEE) $(INCL_RP_DEPS)
# MEX_OPTS = -g -outdir $(MATLAB_SRC) -L$(LIB_DIR) -lrappture $(LIB_SCEW_FLAG)
MEX_OPTS = -g $(LIB_RAPPTURE) $(LIB_SCEW_FLAG)
MATLAB_COMP_ARGS = RpMatlabInterface.cc $(MEX_INCLS) $(MEX_OPTS)

RpMatlab:
	$(MEX) rpLib.cc                   $(MATLAB_COMP_ARGS)
	$(MEX) rpLibXml.cc                $(MATLAB_COMP_ARGS)
	$(MEX) rpLibElement.cc            $(MATLAB_COMP_ARGS)
	$(MEX) rpLibElementAsObject.cc    $(MATLAB_COMP_ARGS)
	$(MEX) rpLibElementAsType.cc      $(MATLAB_COMP_ARGS)
	$(MEX) rpLibElementAsComp.cc      $(MATLAB_COMP_ARGS)
	$(MEX) rpLibElementAsId.cc        $(MATLAB_COMP_ARGS)
	$(MEX) rpLibChildren.cc           $(MATLAB_COMP_ARGS)
	$(MEX) rpLibChildrenByType.cc     $(MATLAB_COMP_ARGS)
#$(MEX) rpChildrenAsObject.cc         $(MATLAB_COMP_ARGS)
#$(MEX) rpChildrenAsType.cc           $(MATLAB_COMP_ARGS)
#$(MEX) rpChildrenAsComp.cc           $(MATLAB_COMP_ARGS)
#$(MEX) rpChildrenAsId.cc             $(MATLAB_COMP_ARGS)
	$(MEX) rpLibGet.cc                $(MATLAB_COMP_ARGS)
	$(MEX) rpLibGetString.cc          $(MATLAB_COMP_ARGS)
	$(MEX) rpLibGetDouble.cc          $(MATLAB_COMP_ARGS)
	$(MEX) rpLibPut.cc                $(MATLAB_COMP_ARGS)
	$(MEX) rpLibPutString.cc          $(MATLAB_COMP_ARGS)
	$(MEX) rpLibPutDouble.cc          $(MATLAB_COMP_ARGS)
	$(MEX) rpLibNodeComp.cc           $(MATLAB_COMP_ARGS)
	$(MEX) rpLibNodeType.cc           $(MATLAB_COMP_ARGS)
	$(MEX) rpLibNodeId.cc             $(MATLAB_COMP_ARGS)
	$(MEX) rpLibResult.cc             $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsDefineUnit.cc       $(MATLAB_COMP_ARGS)
#$(MEX) rpDefineConv.cc               $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsGetUnits.cc         $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsGetUnitsName.cc     $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsGetExponent.cc      $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsGetBasis.cc         $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsFind.cc             $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsMakeMetric.cc       $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsConvert.cc          $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsConvertStr.cc       $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsConvertObjStr.cc    $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsConvertDbl.cc       $(MATLAB_COMP_ARGS)
	$(MEX) rpUnitsConvertObjDbl.cc    $(MATLAB_COMP_ARGS)
	$(MEX) rpAddPresets.cc            $(MATLAB_COMP_ARGS)

docs:
	if test ! -d docs; then \
		mkdir docs; \
	fi
	if test ! -d docs/doxygen; then \
		mkdir docs/doxygen; \
	fi
	doxygen

#### CLEAN UP ############################################################
clean: 
	- rm -f rp*.mex*

distclean: clean
	- rm Makefile
