AC_INIT(src/core/RpLibrary.cc)

VERSION=0.0.1

#------------------------------------------------------------------------
# Handle the --prefix=... option
#------------------------------------------------------------------------

if test "${prefix}" = "NONE"; then
    prefix=/usr/local
fi
if test "${exec_prefix}" = "NONE"; then
    exec_prefix=$prefix
fi

# AC_PROG_INSTALL
AC_PROG_MAKE_SET

dnl find and test the C compiler
AC_PROG_CC
AC_LANG_C

AC_HEADER_STDC
AC_CHECK_FUNC(atol,,AC_MSG_ERROR(oops! no atol ?!?))

AC_PROG_CXX
AC_LANG_CPLUSPLUS

AC_CHECK_LIB(stdc++, main,,AC_MSG_ERROR(librappture requires libstdc++))
AC_CHECK_HEADERS(stack,,AC_MSG_WARN(STL classes missing ?))
AC_CHECK_HEADERS(string,,AC_MSG_WARN(STL classes missing ?))
AC_CHECK_HEADERS(list,,AC_MSG_WARN(STL classes missing ?))
AC_CHECK_HEADERS(vector,,AC_MSG_WARN(STL classes missing ?))

AC_PROG_F77([f77 fort77 g77 f90 xlf xlf90 fl32])

dnl perl and python check borrowed from 
dnl http://www.opensource.apple.com/darwinsource/Current/libxslt-8.1/libxslt/configure.in
dnl
dnl Perl is just needed for generating some data for XSLtmark
dnl

AC_ARG_WITH(perl, [  --with-perl[=DIR]         Build Perl bindings if found])
AC_CHECK_PROG(PERL, perl, perl, false)
dnl AM_CONDITIONAL(WITH_PERL, test "$PERL" != "false")

dnl
dnl check for python
dnl

PYTHON=
PYTHON_VERSION=
PYTHON_INCLUDES=
PYTHON_SITE_PACKAGES=
pythondir=
AC_ARG_WITH(python, [  --with-python[=DIR]       Build Python bindings if found])
if test "$with_python" != "no" ; then
    if test -x "$with_python/bin/python"
    then
        echo Found python in $with_python/bin/python
        PYTHON="$with_python/bin/python"
    else
        if test -x "$with_python"
        then
            echo Found python in $with_python
            PYTHON="$with_python"
        else
            AC_PATH_PROG(PYTHON, python python2.4 python2.3 python2.2 python2.1 python2.0 python1.6 python1.5)
        fi
    fi
    if test "$PYTHON" != ""
    then
        PYTHON_VERSION=`$PYTHON -c "import sys; print sys.version[[0:3]]"`
    echo Found Python version $PYTHON_VERSION
dnl    LIBXML2_PYTHON=`$PYTHON -c "try : import libxml2 ; print 1
dnl except: print 0"`
dnl     if test "$LIBXML2_PYTHON" = "1"
dnl     then
dnl         echo Found libxml2-python module
dnl     else
dnl         echo Warning: Missing libxml2-python
dnl     fi
    fi
    if test "$PYTHON_VERSION" != ""
    then
    if test -r $with_python/include/python$PYTHON_VERSION/Python.h -a \
       -d $with_python/lib/python$PYTHON_VERSION/site-packages
    then
        PYTHON_INCLUDES=$with_python/include/python$PYTHON_VERSION
        PYTHON_SITE_PACKAGES=$with_python/lib/python$PYTHON_VERSION/site-packages
    else
        if test -r $prefix/include/python$PYTHON_VERSION/Python.h
        then
            PYTHON_INCLUDES='$(prefix)/include/python$(PYTHON_VERSION)'
            PYTHON_SITE_PACKAGES='$(libdir)/python$(PYTHON_VERSION)/site-packages'
        else
            if test -r /usr/include/python$PYTHON_VERSION/Python.h
            then
                PYTHON_INCLUDES=/usr/include/python$PYTHON_VERSION
                PYTHON_SITE_PACKAGES='$(libdir)/python$(PYTHON_VERSION)/site-packages'
            else
                echo could not find python$PYTHON_VERSION/Python.h
            fi
        fi
        if test ! -d "$PYTHON_SITE_PACKAGES"
        then
            PYTHON_SITE_PACKAGES=`$PYTHON -c "from distutils import sysconfig; print sysconfig.get_python_lib()"`
        fi
    fi
    fi
    if test "$with_python" != ""
    then
        pythondir='$(PYTHON_SITE_PACKAGES)'
    else
        pythondir='$(libdir)/python${PYTHON_VERSION}/site-packages'
    fi
fi
dnl AM_CONDITIONAL(WITH_PYTHON, test "$PYTHON_INCLUDES" != "")
dnl if test "$PYTHON_INCLUDES" != ""
dnl then
dnl     PYTHON_SUBDIR=python
dnl else
dnl     PYTHON_SUBDIR=
dnl fi
AC_SUBST(pythondir)
dnl AC_SUBST(PYTHON_SUBDIR)

AC_SUBST(PERL)
AC_SUBST(PYTHON)
AC_SUBST(PYTHON_VERSION)
AC_SUBST(PYTHON_INCLUDES)
AC_SUBST(PYTHON_SITE_PACKAGES)

AC_SUBST(VERSION)

RP_BASE=`pwd`
AC_SUBST(RP_BASE)

dnl read Makefile.in and write Makefile
AC_OUTPUT(  Makefile \
            examples/app-fermi/cee/Makefile \
            examples/app-fermi/fortran/Makefile \
            examples/c-example/Makefile \
            perl/Makefile.PL \
            python/setup.py \
            src/Makefile \
            src/matlab/Makefile \
            src/octave/Makefile \
            test/Makefile \
            gui/apps/rappture   )
