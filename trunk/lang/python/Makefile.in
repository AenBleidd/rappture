
bindir          = @bindir@
datadir		= @datadir@
datarootdir	= @datarootdir@
exec_prefix     = @exec_prefix@
includedir      = @includedir@
libdir          = @libdir@
mandir          = @mandir@
prefix          = @prefix@
srcdir		= @srcdir@

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= ${INSTALL} -m 755
INSTALL_DATA	= ${INSTALL} -m 644
INSTALL_SCRIPT	= ${INSTALL} -m 644
RM 		= rm -f
VPATH		= $(srcdir)

PYTHON = 	@PYTHON@
PYTHON_FLAGS = --library-dirs=$(libdir):../../src/core \
               --include-dirs=$(srcdir)/../../src/core:$(includedir)
PYTHON_SITE_PACKAGES = 	@PYTHON_SITE_PACKAGES@

#
# Python distutils doesn't handle VPATH correctly. So copy the sources 
# into a temporary directory.
#
ifneq($(PYTHON_SITE_PACKAGES),)
   MODULE_BUILD		= build_module
   MODULE_INSTALL	= install_module
   MODULE_CLEAN		= clean_module
endif

all: $(MODULE_BUILD)

build_module: copy_sources
	$(PYTHON) setup.py build_ext $(PYTHON_FLAGS) build

copy_sources:
	$(RM) -r build/tmp
	$(INSTALL) -d build/tmp
	$(INSTALL_DATA) $(srcdir)/Rappture/*.cc build/tmp
 
install: $(MODULE_INSTALL)

install_module:
	$(PYTHON) setup.py install --prefix=$(prefix) 

clean: $(MODULE_CLEAN)

clean_module: 
	$(PYTHON) setup.py clean
	$(RM) -rf build 

distclean: clean
