#
# This file is read by nanoscale to determine the ports to listen
# to and the how to start the associated render server.
#
# Render servers
#
#	Server			Port		Usage
#	======			====		=====
#	nanovis			2000		production
#	vtkvis			2010		production
#	geovis			2015		testing
#	vmdshow			2018		testing
#	pymol			2019		testing
#	pymol			2020		production
#
# The syntax is
#	register_server <name> <port> <command> <variables>
#
# This registers a server by the given name at the given port.
# When a connection is made to that port, the command is run
# with the environment variables initialized.  
#
# Note: Don't set DISPLAY here. nanoscale itself sets the DISPLAY
#	variable.
#
# Defaults:
#   o Server reads from file descriptor 0.
#   o Server writes to descriptor 1.
#   o Server stdout and stderr are redirected to a log file.  
#

set exec_prefix "@exec_prefix@"
set bindir "@bindir@"
set libdir "@libdir@"

# GeoVis server (port 2015) --
#     Map renderer
#
register_server geovis 2015 \
    -output 3 -logstdout no -logstderr no \
{
    ${bindir}/geovis -o 3
} {
    LD_LIBRARY_PATH ${libdir}
}

# NanoVis server (port 2000) --
#     Volume renderer
#
register_server nanovis 2000 \
    -output 3 -logstdout no -logstderr no \
{
    ${bindir}/nanovis -o 3 -p ${libdir}/shaders:${libdir}/resources
} {
    LD_LIBRARY_PATH ${libdir}
}

# VtkVis server (port 2010)--
#    3D drawings (scene graphs), Contour and surface graphs.
#    Can remove ":${vtkdir} when moving to VTK 6.
#
register_server vtkvis 2010 \
    -output 3 -logstdout no -logstderr no \
{
    ${bindir}/vtkvis -o 3
} {
    LD_LIBRARY_PATH ${libdir}
}

# Pymol experimental server (port 2019) --
#     Molecular layouts from PDB description.  
#     Need PYMOL_SITE_PATH only for parallelpiped box.py location.
#    
register_server pymolproxy 2019 {
    ${bindir}/pymolproxy ${bindir}/pymol -p -q -i -x -X 0 -Y 0
} {
    PYMOL_SITE_PATH ${libdir}/pymol
    LD_LIBRARY_PATH ${libdir}
}

# Pymol server (threaded version of proxy) (port 2010) --
#     Molecular layouts from PDB description.  
#     Need PYMOL_SITE_PATH only for parallelpiped box.py location.
#    
register_server pymolproxy-threaded 2020 \
    -logstdout no -logstderr no \
{
    ${bindir}/pymolproxy2 ${bindir}/pymol -p -q -i -x -X 0 -Y 0
} {
    PYMOL_SITE_PATH ${libdir}/pymol
    LD_LIBRARY_PATH ${libdir}
}

# vmd server (used for mdshowcase)
#
register_server vmdshow 2018 \
    -input 3 -output 4 -combinelogs no \
{
    ${libdir}/vmd/vmd_LINUXAMD64 -startup ${libdir}/vmd/vmdserver.tcl \
	-args -stdio 
} {
    VMDDIR ${libdir}/vmd
    SURF_BIN ${libdir}/vmd/surf
    LD_LIBRARY_PATH ${libdir}
} 
    

