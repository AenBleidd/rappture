DEBUG			= #yes
TRACE			= #yes
USE_CUSTOM_AXES		= yes
USE_GPU_RAYCASTING	= yes
USE_OFFSCREEN_RENDERING	= #yes
USE_THREADS		= yes
USE_VTK6                = yes

bindir          = @bindir@
datadir         = @datadir@
datarootdir     = @datarootdir@
exec_prefix     = @exec_prefix@
includedir      = @includedir@
libdir          = @libdir@
mandir          = @mandir@
prefix          = @prefix@
srcdir          = @srcdir@

CC		= @CC@
CXX		= @CXX@
CFLAGS		= @CFLAGS@
CXXFLAGS	= @CXXFLAGS@

VPATH           = $(srcdir)

INSTALL         = @INSTALL@
INSTALL_PROGRAM = ${INSTALL} -m 0755
INSTALL_DATA    = ${INSTALL} -m 0644
INSTALL_SCRIPT  = ${INSTALL} -m 0644
MKDIR_P		= @MKDIR_P@

SVN_VERSION	= $(shell svnversion $(srcdir))
STATSDIR	= @STATSDIR@

GL_LIB_SPEC	= -lGL -lm
PTHREAD_LIB_SPEC= -lpthread

TCL_LIB_SPEC    = @TCL_LIB_SPEC@
TCL_INC_SPEC    = @TCL_INC_SPEC@

VTK_LIB_DIR	= @VTK_LIB_DIR@
VTK_LIB_SPEC	= -L$(VTK_LIB_DIR) \
		-lvtkChemistry \
		-lvtkIO \
		-lvtkWidgets \
		-lvtkFiltering \
		-lvtkVolumeRendering \
		-lvtkRendering \
		-lvtkHybrid \
		-lvtkGraphics \
		-lvtkImaging \
		-lvtkCommon
VTK_INC_SPEC	= @VTK_INC_SPEC@
VTK6_LIB_SPEC   = \
		-lvtkDomainsChemistry-6.0 \
		-lvtkIOCore-6.0 \
		-lvtkIOLegacy-6.0 \
		-lvtkFiltersModeling-6.0 \
		-lvtkFiltersFlowPaths-6.0 \
		-lvtkFiltersGeometry-6.0 \
		-lvtkFiltersSources-6.0 \
		-lvtkFiltersGeneral-6.0 \
		-lvtkFiltersCore-6.0 \
		-lvtkImagingHybrid-6.0 \
		-lvtkImagingCore-6.0 \
		-lvtkInteractionStyle-6.0 \
		-lvtkInteractionWidgets-6.0 \
		-lvtkRenderingOpenGL-6.0 \
		-lvtkRenderingHybridOpenGL-6.0 \
		-lvtkRenderingFreeTypeOpenGL-6.0 \
		-lvtkRenderingFreeType-6.0  \
		-lvtkRenderingVolumeOpenGL-6.0 \
		-lvtkRenderingVolume-6.0 \
		-lvtkRenderingLabel-6.0 \
		-lvtkRenderingAnnotation-6.0 \
		-lvtkRenderingCore-6.0 \
		-lvtkCommonCore-6.0 \
		-lvtkCommonDataModel-6.0 \
		-lvtkCommonExecutionModel-6.0  \
		-lvtkCommonMisc-6.0  \
		-lvtkCommonTransforms-6.0 \
		-lvtkCommonMath-6.0

ifdef USE_VTK6
VTK_LIB_SPEC	= $(VTK6_LIB_SPEC)
endif

ifdef USE_VTK6
LD_RUN_PATH	= $(libdir)
else
LD_RUN_PATH	= $(libdir):$(VTK_LIB_DIR)
endif

LIBS		= \
		$(TCL_LIB_SPEC) \
		$(VTK_LIB_SPEC) \
		$(GL_LIB_SPEC) \
		$(PTHREAD_LIB_SPEC) \
		-Wl,-rpath,$(LD_RUN_PATH) \
		-Wl,--enable-new-dtags

INCLUDES	= \
		-I$(srcdir) \
		$(TCL_INC_SPEC) \
		$(VTK_INC_SPEC)

#vtk uses deprecated strstream header (instead of sstream)
EXTRA_CXXFLAGS	= -Wall -Wno-deprecated
EXTRA_CFLAGS	= -Wall
DEFINES		= -DSVN_VERSION=\"$(SVN_VERSION)\" -DSTATSDIR=\"$(STATSDIR)\"
ifdef DEBUG
DEFINES 	+= -DDEBUG
CXXFLAGS	= -O0 -g
endif
ifdef TRACE
DEFINES		+= -DWANT_TRACE
endif
ifdef USE_CUSTOM_AXES
DEFINES 	+= -DUSE_CUSTOM_AXES
endif
ifdef USE_OFFSCREEN_RENDERING
DEFINES         += -DUSE_OFFSCREEN_RENDERING
endif
ifdef USE_GPU_RAYCASTING
DEFINES         += -DUSE_GPU_RAYCAST_MAPPER
endif
ifdef USE_THREADS
DEFINES         += -DUSE_THREADS
endif
ifdef USE_VTK6
VTK_MOD_DEFS    = -DvtkRenderingCore_AUTOINIT="4(vtkInteractionStyle,vtkRenderingFreeType,vtkRenderingFreeTypeOpenGL,vtkRenderingOpenGL)" -DvtkRenderingVolume_AUTOINIT"1(vtkRenderingVolumeOpenGL)"
DEFINES         += -DUSE_VTK6 $(VTK_MOD_DEFS)
endif

CXX_SWITCHES	= $(CXXFLAGS) $(EXTRA_CXXFLAGS) $(DEFINES) $(INCLUDES)
CC_SWITCHES	= $(CFLAGS) $(EXTRA_CFLAGS) $(DEFINES) $(INCLUDES)

SERVER_SRCS	= \
		CmdProc.cpp \
		ColorMap.cpp \
		PPMWriter.cpp \
		ReadBuffer.cpp \
		RpArc.cpp \
		RpArrow.cpp \
		RpBox.cpp \
		RpCone.cpp \
		RpContour2D.cpp \
		RpContour3D.cpp \
		RpCutplane.cpp \
		RpCylinder.cpp \
		RpDisk.cpp \
		RpGlyphs.cpp \
		RpGroup.cpp \
		RpHeightMap.cpp \
		RpLine.cpp \
		RpLIC.cpp \
		RpMolecule.cpp \
		RpOutline.cpp \
		RpPolyData.cpp \
		RpPolygon.cpp \
		RpPseudoColor.cpp \
		RpShape.cpp \
		RpSphere.cpp \
		RpStreamlines.cpp \
		RpVolume.cpp \
		RpVtkDataSet.cpp \
		RpVtkGraphicsObject.cpp \
		RpVtkRenderer.cpp \
		RpVtkRendererCmd.cpp \
		RpVtkRendererGraphicsObjs.cpp \
		RpVtkRenderServer.cpp \
		RpWarp.cpp \
		TGAWriter.cpp \
		Trace.cpp 

ifdef USE_CUSTOM_AXES
SERVER_SRCS+= \
	vtkRpAxisActor.cpp \
	vtkRpAxisFollower.cpp \
	vtkRpCubeAxesActor.cpp
endif
ifdef USE_THREADS
SERVER_SRCS+=ResponseQueue.cpp
endif

SERVER_OBJS=$(SERVER_SRCS:.cpp=.o)
SERVER_OBJS+= md5.o
SERVER=vtkvis

.PHONY: all docs install clean clean-docs distclean

all: $(SERVER)

docs:
	$(MKDIR_P) -m 0755 docs/doxygen
	doxygen

$(SERVER): $(SERVER_OBJS)
	$(CXX) $(LIBS) -o $@ $(SERVER_OBJS)

install: all
	$(INSTALL_PROGRAM) $(SERVER) $(bindir)

%.o: %.cpp
	$(CXX) $(CXX_SWITCHES) -c $< -o $@

%.o: %.c
	$(CC) $(CC_SWITCHES) -c $< -o $@

clean:
	$(RM) *~ *.o $(SERVER)

clean-docs:
	$(RM) -r docs

distclean: clean clean-docs
	$(RM) Makefile Doxyfile

CmdProc.o: CmdProc.h
ColorMap.o: ColorMap.h RpMolecule.h Trace.h
PPMWriter.o: PPMWriter.h ResponseQueue.h Trace.h
ReadBuffer.o: ReadBuffer.h Trace.h
ResponseQueue.o: ResponseQueue.h Trace.h
RpArc.o: RpArc.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpArrow.o: RpArrow.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpBox.o: RpBox.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpCone.o: RpCone.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpContour2D.o: RpContour2D.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpContour3D.o: RpContour3D.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpCutplane.o: RpCutplane.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpCylinder.o: RpCylinder.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpDisk.o: RpDisk.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpGlyphs.o: RpGlyphs.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpGroup.o: RpGroup.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpHeightMap.o: RpHeightMap.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpLine.o: RpLine.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpLIC.o: RpLIC.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h RpVtkRenderServer.h
RpMolecule.o: RpMolecule.h RpMoleculeData.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpMolecule2.o: RpMolecule2.h RpMoleculeData.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpOutline.o: RpOutline.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpPolyData.o: RpPolyData.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpPolygon.o: RpPolygon.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpPseudoColor.o: RpPseudoColor.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpShape.o: RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpSphere.o: RpSphere.h RpShape.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h Trace.h
RpStreamlines.o: RpStreamlines.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpVolume.o: RpVolume.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
RpVtkDataSet.o: RpVtkDataSet.h Trace.h
RpVtkGraphicsObject.o: RpVtkGraphicsObject.h RpVtkRenderer.h RpVtkDataSet.h ColorMap.h Trace.h
RpVtkRenderer.o: RpVtkRenderer.h RpVtkRendererGraphicsObjs.h vtkRpCubeAxesActor.h vtkRpAxisFollower.h vtkRpAxisActor.h RpMath.h RpVtkDataSet.h RpArc.h RpArrow.h RpBox.h RpCone.h RpContour2D.h RpContour3D.h RpCutplane.h RpCylinder.h RpDisk.h RpGlyphs.h RpGroup.h RpHeightMap.h RpLIC.h RpLine.h RpMolecule.h RpOutline.h RpPolyData.h RpPolygon.h RpPseudoColor.h RpSphere.h RpStreamlines.h RpVolume.h ColorMap.h Trace.h
RpVtkRendererCmd.o: RpVtkRenderer.h RpVtkRendererGraphicsObjs.h vtkRpCubeAxesActor.h vtkRpAxisFollower.h vtkRpAxisActor.h RpVtkDataSet.h RpArc.h RpArrow.h RpBox.h RpCone.h RpContour2D.h RpContour3D.h RpCutplane.h RpCylinder.h RpDisk.h RpGlyphs.h RpGroup.h RpHeightMap.h RpLIC.h RpLine.h RpMolecule.h RpOutline.h RpPolyData.h RpPolygon.h RpPseudoColor.h RpSphere.h RpStreamlines.h RpVolume.h ColorMap.h ReadBuffer.h ResponseQueue.h Trace.h CmdProc.h PPMWriter.h TGAWriter.h
RpVtkRendererGraphicsObjs.o: RpVtkRenderer.h RpVtkRendererGraphicsObjs.h RpVtkDataSet.h RpArc.h RpArrow.h RpBox.h RpCone.h RpContour2D.h RpContour3D.h RpCutplane.h RpCylinder.h RpDisk.h RpGlyphs.h RpGroup.h RpHeightMap.h RpLIC.h RpLine.h RpMolecule.h RpOutline.h RpPolyData.h RpPolygon.h RpPseudoColor.h RpSphere.h RpStreamlines.h RpVolume.h ColorMap.h Trace.h
RpVtkRenderServer.o: RpVtkRenderServer.h RpVtkRendererCmd.h RpVtkRenderer.h vtkRpCubeAxesActor.h vtkRpAxisFollower.h vtkRpAxisActor.h ReadBuffer.h ResponseQueue.h Trace.h PPMWriter.h TGAWriter.h
RpWarp.o: RpWarp.h RpVtkGraphicsObject.h RpVtkDataSet.h RpVtkRenderer.h ColorMap.h Trace.h
Trace.o: Trace.h
TGAWriter.o: TGAWriter.h ResponseQueue.h Trace.h
vtkRpAxisActor.o: vtkRpAxisActor.h
vtkRpAxisFollower.o: vtkRpAxisFollower.h vtkRpAxisActor.h
vtkRpCubeAxesActor.o: vtkRpCubeAxesActor.h vtkRpAxisFollower.h vtkRpAxisActor.h
md5.o: md5.h
