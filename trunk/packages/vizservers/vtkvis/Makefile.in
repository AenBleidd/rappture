
bindir          = @bindir@
datadir         = @datadir@
datarootdir     = @datarootdir@
exec_prefix     = @exec_prefix@
includedir      = @includedir@
libdir          = @libdir@
mandir          = @mandir@
prefix          = @prefix@
srcdir          = @srcdir@

CC		= @CC@
CXX		= @CXX@
CFLAGS		= @CFLAGS@
CXXFLAGS	= @CXXFLAGS@

VPATH           = $(srcdir)

INSTALL         = @INSTALL@
INSTALL_PROGRAM = ${INSTALL} -m 0755
INSTALL_DATA    = ${INSTALL} -m 0644
INSTALL_SCRIPT  = ${INSTALL} -m 0644
MKDIR_P		= @MKDIR_P@

GL_LIB_SPEC	= -lGL -lm

TCL_LIB_SPEC    = @TCL_LIB_SPEC@
TCL_INC_SPEC    = @TCL_INC_SPEC@

VTK_LIB_DIR	= @VTK_LIB_DIR@
VTK_LIB_SPEC	= -L$(VTK_LIB_DIR) -lvtkIO -lvtkWidgets -lvtkFiltering -lvtkVolumeRendering -lvtkRendering -lvtkHybrid -lvtkGraphics -lvtkImaging -lvtkCommon
VTK_INC_SPEC	= @VTK_INC_SPEC@

LD_RUN_PATH	= $(VTK_LIB_DIR)

LIBS		= \
		$(GL_LIB_SPEC) \
		$(TCL_LIB_SPEC) \
		$(VTK_LIB_SPEC) \
		-Wl,-rpath,$(LD_RUN_PATH)

INCLUDES	= \
		-I. \
		$(TCL_INC_SPEC) \
		$(VTK_INC_SPEC)

DEBUG			= #yes
TRACE			= #yes
USE_CUSTOM_AXES 	= #yes
USE_GPU_RAYCASTING      = yes
USE_OFFSCREEN_RENDERING = yes

#vtk uses deprecated strstream header (instead of sstream)
EXTRA_CFLAGS	= -Wall -Wno-deprecated
DEFINES		=
ifdef DEBUG
DEFINES 	+= -DDEBUG
CXXFLAGS	= -O0 -g
endif
ifdef TRACE
DEFINES		+= -DWANT_TRACE
endif
ifdef USE_CUSTOM_AXES
DEFINES 	+= -DUSE_CUSTOM_AXES
endif
ifdef USE_OFFSCREEN_RENDERING
DEFINES         += -DUSE_OFFSCREEN_RENDERING
endif
ifdef USE_GPU_RAYCASTING
DEFINES         += -DUSE_GPU_RAYCAST_MAPPER
endif
CXX_SWITCHES	= $(CXXFLAGS) $(EXTRA_CFLAGS) $(DEFINES) $(INCLUDES)

SERVER_SRCS	= \
		CmdProc.cpp \
		ColorMap.cpp \
		PPMWriter.cpp \
		RpContour2D.cpp \
		RpContour3D.cpp \
		RpGlyphs.cpp \
		RpHeightMap.cpp \
		RpLIC.cpp \
		RpMolecule.cpp \
		RpPolyData.cpp \
		RpPseudoColor.cpp \
		RpStreamlines.cpp \
		RpVolume.cpp \
		RpVtkDataSet.cpp \
		RpVtkRenderer.cpp\
		RpVtkRendererCmd.cpp \
		RpVtkRenderServer.cpp \
		TGAWriter.cpp \
		Trace.cpp

ifdef USE_CUSTOM_AXES
SERVER_SRCS+=vtkRpCubeAxesActor2D.cpp
endif

SERVER_OBJS=$(SERVER_SRCS:.cpp=.o)

SERVER=vtkvis

.PHONY: all docs install clean clean-doc distclean

all: $(SERVER)

docs:
	$(MKDIR_P) -m 0755 docs/doxygen
	doxygen

$(SERVER): $(SERVER_OBJS)
	$(CXX) $(LIBS) -o $@ $(SERVER_OBJS)

install: $(SERVER)
	$(INSTALL_PROGRAM) $(SERVER) $(bindir)

%.o: %.cpp
	$(CXX) $(CXX_SWITCHES) -c $< -o $@

clean:
	$(RM) *~ *.o $(SERVER)

clean-docs:
	$(RM) -r docs

distclean: clean clean-docs
	$(RM) Makefile Doxyfile

CmdProc.o: CmdProc.h
ColorMap.o: ColorMap.h RpMolecule.h Trace.h
PPMWriter.o: PPMWriter.h Trace.h
RpContour2D.o: RpContour2D.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpContour3D.o: RpContour3D.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpGlyphs.o: RpGlyphs.h RpVtkGraphicsObject.h RpVtkDataSet.h ColorMap.h Trace.h
RpHeightMap.o: RpHeightMap.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpLIC.o: RpLIC.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h RpVtkRenderServer.h
RpMolecule.o: RpMolecule.h RpMoleculeData.h RpVtkGraphicsObject.h RpVtkDataSet.h ColorMap.h Trace.h
RpPolyData.o: RpPolyData.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpPseudoColor.o: RpPseudoColor.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpStreamlines.o: RpStreamlines.h RpVtkGraphicsObject.h RpVtkDataSet.h Trace.h
RpVolume.o: RpVolume.h RpVtkGraphicsObject.h RpVtkDataSet.h ColorMap.h Trace.h
RpVtkDataSet.o: RpVtkDataSet.h Trace.h
RpVtkRenderer.o: RpVtkRenderer.h RpVtkDataSet.h RpContour2D.h RpContour3D.h RpGlyphs.h RpHeightMap.h RpLIC.h RpMolecule.h RpPolyData.h RpPseudoColor.h RpStreamlines.h RpVolume.h ColorMap.h Trace.h
RpVtkRendererCmd.o: RpVtkRenderer.h RpVtkDataSet.h RpContour2D.h RpContour3D.h RpGlyphs.h RpHeightMap.h RpLIC.h RpMolecule.h RpPolyData.h RpPseudoColor.h RpStreamlines.h RpVolume.h ColorMap.h Trace.h CmdProc.h PPMWriter.h TGAWriter.h
RpVtkRenderServer.o: RpVtkRenderServer.h RpVtkRendererCmd.h RpVtkRenderer.h Trace.h PPMWriter.h TGAWriter.h
Trace.o: Trace.h
TGAWriter.o: TGAWriter.h Trace.h
vtkRpCubeAxesActor2D.o: vtkRpCubeAxesActor2D.h
