all: rplib bindings
install: install_rplib install_bindings install_examples

###########################################################################
# Makefile - build and install all Rappture libraries
#############################################################################


rplib:
	set -x;
	cd src; make clean; make librappture;

install_rplib:
	set -x;
	cd src; make install

bindings:
	set -x;
	cd src;			\
	make RpMatlab;	\
	make RpOctave;	\
	cd -
#	make RpTcl;
	make build_python_bindings;
	make build_perl_bindings;

install_bindings:

#############################################################################
# build rappture examples
# examples:
# 	- compile rappture examples in rappture/examples
#############################################################################
examples:
	set -x;
	cd examples/app-fermi/fortran; make clean; make; cd -
	cd examples/app-fermi/cee; make clean; make; cd -
	cd examples/c-example; make clean; make; cd -

install_examples: examples

#############################################################################

build_python_bindings:
	set -x;
	cd python; \
	@PYTHON@ setup.py \
		build_ext \
		--library-dirs=@prefix@/lib \
		--include-dirs=@prefix@/include/core \
		build

install_python_bindings: build_python_bindings
	set -x;
	cd python; \
	@PYTHON@ setup.py install --prefix=@prefix@

build_perl_bindings:
	set -x;
	cd perl; \
	@PERL@ Makefile.PL INSTALLSITELIB=@prefix@/lib/perl5 INSTALLSITEMAN3DIR=@prefix@/man/man3; \
	make; make test;

install_perl_bindings: build_perl_bindings
	set -x;
	cd perl; make install;

clean:
	cd examples/app-fermi/cee; make clean; cd -;
	cd examples/app-fermi/fortran; make clean; cd -;
	cd examples/c-example; make clean; cd -;
	cd perl; make clean; cd -;
	cd python; rm -rf build; rm setup.py; cd -;
	cd src; make clean; cd -;
	cd src/matlab; make clean; cd -;
	cd src/octave; make clean; cd -;

distclean:
	cd examples/app-fermi/cee; make distclean; cd -;
	cd examples/app-fermi/fortran; make distclean; cd -;
	cd examples/c-example; make distclean; cd -;
	cd perl; make clean; cd -;
	cd python; rm -rf build; rm setup.py; cd -;
	cd src; make distclean; cd -;
	cd src/matlab; make distclean; cd -;
	cd src/octave; make distclean; cd -;
	cd test; make distclean; cd -;
	rm gui/apps/rappture;
	rm -r Makefile config.status config.log;
