
bindir          = @bindir@
datadir		= @datadir@
datarootdir	= @datarootdir@
exec_prefix     = @exec_prefix@
includedir      = @includedir@
libdir          = @libdir@
mandir          = @mandir@
prefix          = @prefix@
srcdir		= @srcdir@

INSTALL		= @INSTALL@
SHELL		= @SHELL@
MKDIR_P		= @MKDIR_P@
RM		= rm -f
VPATH		= $(srcdir)

build_date	:= $(shell date +%Y%m%d)
machine		:= $(shell uname -m | sed 's/\ //')
os		:= $(shell uname -s)

pkg_path	:= $(shell dirname $(prefix))
pkg_name	:= $(shell basename $(prefix))

rappture_binary_tarfile	= rappture-$(os)-$(machine)-$(build_date).tar.gz
rappture_source_tarfile = rappture-src-$(build_date).tar.gz
runtime_source_tarfile = rappture-runtime-src-$(build_date).tar.gz

runtime_repo = https://repo.nanohub.org/svn/rappture-runtime/trunk
rappture_repo = https://repo.nanohub.org/svn/rappture/trunk

ENABLE_GUI	= @ENABLE_GUI@

TARGETS		= src 

ifneq ($(ENABLE_GUI),)
  TARGETS += gui lang lib examples
endif

.NOTPARALLEL:

.PHONY: $(TARGETS)

all: $(TARGETS)

src:
	$(MAKE) -C src all
gui: 
	$(MAKE) -C gui all
lang: 
	$(MAKE) -C lang all
examples: 
	$(MAKE) -C examples all
lib: 
	$(MAKE) -C lib all
test: 
	#$(MAKE) -C test all

install: 
	for i in $(TARGETS) ; do \
	  $(MAKE) -C $$i install || exit 1 ;\
	done

clean:
	$(MAKE) -C examples clean
	$(MAKE) -C gui clean
	$(MAKE) -C lang clean
	$(MAKE) -C lib clean
	$(MAKE) -C src clean
	$(MAKE) -C test clean

distclean: 
	$(MAKE) -C examples distclean
	$(MAKE) -C gui distclean
	$(MAKE) -C lang distclean
	$(MAKE) -C lib distclean
	$(MAKE) -C src distclean
	$(MAKE) -C test distclean
	$(RM) Makefile config.status config.log  *~

package: 
	tar -C $(pkg_path) -czlf $(rappture_binary_tarfile) $(pkg_name)

distrib: 
	$(RM) -r exported
	$(MKDIR_P) exported
	(cd exported; svn export -q $(rappture_repo) rappture)
	tar -C exported -czlf $(rappture_source_tarfile) rappture
	$(RM) -r exported

runtime-distrib:
	$(RM) -r exported
	$(MKDIR_P) exported
	(cd exported; svn export -q $(runtime_repo) runtime)
	tar -C exported -czlf $(runtime_source_tarfile) runtime
	$(RM) -r exported
