
bindir          = @bindir@
datadir		= @datadir@
datarootdir	= @datarootdir@
exec_prefix     = @exec_prefix@
includedir      = @includedir@
libdir          = @libdir@
mandir          = @mandir@
prefix          = @prefix@
srcdir		= @srcdir@

INSTALL		= @INSTALL@
SHELL		= @SHELL@
MKDIR_P		= @MKDIR_P@
RM		= rm -f
VPATH		= $(srcdir)

build_date	:= $(shell date +%Y%m%d)
machine		:= $(shell uname -m | sed 's/\ //')
os		:= $(shell uname -s)
bn		:= $(shell basename $(prefix))

binary_tarfile	= rappture-$(os)-$(machine)-$(build_date).tar.gz
source_tarfile	= rappture-src-$(build_date).tar.gz

ENABLE_GUI	= @ENABLE_GUI@

TARGETS		= src 

ifneq ($(ENABLE_GUI),)
  TARGETS += gui lang examples lib
endif


.PHONY: $(TARGETS)

all: $(TARGETS)

src:
	$(MAKE) -C src all
gui:
	$(MAKE) -C gui all
lang:
	$(MAKE) -C lang all
lib:
	$(MAKE) -C lib all
examples:
	$(MAKE) -C examples all
test:
	#$(MAKE) -C test all

install: 
	for i in $(TARGETS) ; do \
	  $(MAKE) -C $$i install || exit 1 ;\
	done

clean:
	$(MAKE) -C examples clean
	$(MAKE) -C gui clean
	$(MAKE) -C lang clean
	$(MAKE) -C lib clean
	$(MAKE) -C src clean
	$(MAKE) -C test clean

distclean: 
	$(MAKE) -C examples distclean
	$(MAKE) -C gui distclean
	$(MAKE) -C lang distclean
	$(MAKE) -C lib distclean
	$(MAKE) -C src distclean
	$(MAKE) -C test distclean
	$(RM) Makefile config.status config.log  *~

package: 
	tar -C $(prefix) -czlf $(binary_tarfile) .

distrib: 
	$(RM) -r exported
	$(MKDIR_P) exported
	(cd exported; \
	    svn exported https://repo.nanohub.org/svn/rappture/trunk rappture)
	tar -C exported -czlf $(source_tarfile) rappture
	$(RM) -r exported
