================================================================================
================================================================================
Protocol for geovis render server.  

Commands take the general form of command and arguments using Tcl syntax and are 
terminated by a newline.  Some command arguments expect a Tcl list which can be
sent by enclosing the list in curly braces to prevent the interpreter from 
splitting the list into multiple arguments.  Likewise, strings with spaces 
should be quoted or enclosed in curly braces.  In the documentation below,
arguments are indicated by angle brackets and optional arguments are surrounded
by question marks -- the brackets and question marks are not part of the
protocol and should not be included in argument strings.  The arguments shown 
in angle brackets should be replaced with a string (where there are fixed 
choices this document indicates valid values by separating them with pipe 
symbols), a list in Tcl syntax, or a numeric value.  Boolean arguments can take
the form of 0|1, true|false, or yes|no.  Since the protocol commands are 
executed in a Tcl interpreter, Tcl code such as math expressions in expr 
commands enclosed in square brackets are also allowed.  Since the interpreter
is a "safe" interpreter, some Tcl commands that could cause security issues may 
not be available for use.

When binary data is to be sent, it should follow the newline after a command 
that indicates incoming data including a byte count argument.
================================================================================
================================================================================
Requests:
================================================================================

== General dataset, scene and renderer commands ==

camera delete <name>
       Delete named viewpoint
camera dist <distance>
       Set camera distance from focal point
camera get
       Request camera parameters
camera go <x> <y> <?duration?>
       Move camera to new focal point.
       <x>,<y> = Screen/mouse coordinates
       <duration> = Duration of viewpoint move animation in seconds
camera orient <quatW> <quatX> <quatY> <quatZ>
       Set scene orientation using a quaternion
camera pan <x> <y>
       <x,y> viewport coordinates (window center at 0,0).  Positive x pan
       means pan object to right (camera to left).  Positive y pan means
       pan object down (camera up).  For example a pan of 0.5, 0.5 would
       move the object center to the lower right corner of the window
camera reset <?all?>
       Option all resets orientation/rotation as well as pan/zoom/clip range
camera restore <name> <?duration?>
       Set viewpoint to a named viewpoint, with optional animation duration in seconds
camera rotate <x> <y>
       Specify relative rotation in viewport coordinates
camera save <name>
       Save current viewpoint to a named viewpoint
camera set <x> <y> <z> <heading> <pitch> <distance> <?duration?> <?srs?> <?vertDatum?>
       Explicitly set camera parameters, with optional animation duration in seconds
       <x>, <y> = Map coordinates of focal point
       <z> = Altitude of focal point (see vertDatum)
       <heading> = Azimuth in degrees
       <pitch> = Elevation in degrees
       <distance> = Distance of camera from focal point in map units(?)
       <srs> = coordinate system, defaults to map coordinate system
       <vertDatum> = vertical datum for interpreting z coordinate 
camera zoom <y>
       Specify zoom by viewport coordinates (i.e. normalized y mouse coords)

clientinfo <list>

key press <key>
key release <key>

mouse click <button> <x> <y>
mouse dblclick <button> <x> <y>
mouse drag <button> <x> <y>
mouse motion <x> <y>
mouse release <button> <x> <y>
mouse scroll <direction>

renderer render
         Force a new image to be rendered

screen bgcolor <r> <g> <b>
screen size <width> <height>

map coords <x> <y>
    Translate screen/mouse coordinates into map coordinates

General form:
map layer add <type> <driver> <url> ... <layerName>
    <type> = image|elevation|line|point|polygon|text
    <driver> = gdal|wms|tms

Specific layer types:
map layer add image gdal <url> <layerName>
    Add a GDAL image layer from a file or URL
map layer add image wms <url> <layers> <format> <transparent> <layerName>
    Add a WMS image layer from a URL + layer string
    <url> = URL of WMS service
    <layers> = layers string for WMS server
    <format> = Image format to return (e.g. 'png')
    <transparent> = bool
map layer add image tms <url> <layerName>
    Add a TMS image layer from a URL
    <url> = URL of TMS service
map layer add elevation <driver> <url> <layerName>
    Add an elevation image layer from a file or URL
    <driver> = gdal|tms|wms
map layer add point <url> <layerName>
    Add a point feature layer from a file or URL
map layer add polygon <url> <layerName>
    Add a polygon feature layer from a file or URL
map layer add line <url> <layerName>
    Add a line feature layer from a file or URL
map layer add text <url> <layerName>
    Add a text symbol layer from a file or URL

map layer delete <layerName>
map layer opacity <opacity> <layerName>
map layer move <pos> <layerName>
map layer visible <bool> <layerName>
map load data follows <nbytes>
    Send an .earth file over the wire
map load file <path>
    Load an .earth file from a filesystem mounted on the server
map load url <url>
    Load an .earth file from a network address
map reset <type> <?profile?> <?xmin?> <?ymin?> <?xmax?> <?ymax?>
    Clear the scene and rebuild a new map from scratch.  When resetting the 
    map to geocentric, a profile and extents should be omitted.  When the map
    type is projected, the profile is required and extents are optional.
    type = geocentric|projected
    profile = Well known profile string, e.g. 'global-geodetic',
    'global-mercator'.  If specifying bounds (i.e. not global), use 'geodetic'
    or 'spherical-mercator' or an SRS init string (such as an EPSG code)
    xmin,ymin,xmax,ymax = map bounds (in profile projection/units)

================================================================================
Replies:
================================================================================
nv>image -type image -bytes <nbytes>
  <binary RGB data>
nv>dataset coords <x> <y> <z>
nv>ok -token <seqnum>
   Reply indicated commands through <seqnum> (numbered beginning at 1) have been
   processed, but no new image was rendered
================================================================================
Error Replies:
================================================================================
nv>viserror -bytes <nbytes>
   <multi-line error string of nbytes>
================================================================================
