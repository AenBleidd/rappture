
CC		= @CC@
CFLAGS		= @CFLAGS@
EXTRA_CFLAGS	= -Wall 
CC_SWITCHES	= $(CFLAGS) $(EXTRA_CFLAGS) $(INCLUDES) $(DEFINES)
LDFLAGS         = @LDFLAGS@

bindir          = @bindir@
datadir		= @datadir@
datarootdir	= @datarootdir@
exec_prefix     = @exec_prefix@
includedir      = @includedir@
libdir          = @libdir@
mandir          = @mandir@
prefix          = @prefix@
srcdir		= @srcdir@

VPATH		= $(srcdir)

INSTALL         = @INSTALL@
INSTALL_PROGRAM = ${INSTALL} -m 0555
INSTALL_DATA    = ${INSTALL} -m 0444
INSTALL_SCRIPT  = ${INSTALL} -m 0444
RM		= rm -f

SERVER_OBJS	= server.o
CLIENT_OBJS	= client.o clientlib.o

TCL_LIB_SPEC    = @TCL_LIB_SPEC@
TCL_INC_SPEC    = @TCL_INC_SPEC@
LD_RUN_PATH     = $(libdir)

DEFINES		= -DSERVERSFILE=\"$(libdir)/renderservers.tcl\"
INCLUDES	= -I. $(TCL_INC_SPEC)
LIBS		= $(TCL_LIB_SPEC) \
		-Wl,-rpath,$(LD_RUN_PATH)

.PHONY: all install clean distclean

TARGETS         = nanoscale

all: $(TARGETS)

nanoscale: $(SERVER_OBJS)
	$(CC) $(CC_SWITCHES) -o $@ $^ $(LIBS)

install: nanoscale renderservers.tcl
	$(INSTALL_PROGRAM) -D nanoscale $(bindir)/nanoscale
	$(INSTALL_SCRIPT) renderservers.tcl $(libdir)

client: $(CLIENT_OBJS)

.c.o:
	$(CC) $(CC_SWITCHES) -o $@ -c $<

clean:
	$(RM) -r a.out $(SERVER_OBJS) *~ core* $(TARGETS) *.log *.tmp logfile* .deps/*.d

distclean: clean
	$(RM) Makefile config.h renderservers.tcl

