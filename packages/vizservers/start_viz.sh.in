#! /bin/sh

DISPLAY=:0
export DISPLAY

broadcast="192.168.200.255"
install_dir="@prefix@"
nanoscale_port=2000
nanovis_port=2000
pymol_port=2020

dir=$( mktemp -d /tmp/nanorun.XXXXXX )

PATH=${dir}/bin:$PATH
LD_LIBRARY_PATH=${dir}/lib:$LD_LIBRARY_PATH
PYMOL_PATH=${dir}/lib/pymol
export PATH LD_LIBRARY_PATH PYMOL_PATH

nanoscale="${dir}/bin/nanoscale -b $nanoscale_port -s $broadcast"
nanovis="${dir}/bin/nanovis -p ${dir}/lib/shaders:${dir}/lib/resources"
pymolproxy="${dir}/bin/pymolproxy ${dir}/bin/pymol -p -q -i -x -X 0 -Y 0"

cp -r ${install_dir}/* ${dir}

cd ${dir}

minutes=20
ulimit -t $(expr ${minutes} \* 60 )

#$nanoscale -d -l $nanovis_port -c $nanovis
#$nanoscale -d -l $pymol_port -c $pymolproxy

#echo "$nanoscale -l $nanovis_port -c \"$nanovis\" -l $pymol_port -c \"$pymolproxy\""
#$nanoscale -l $nanovis_port -c "$nanovis" -l $pymol_port -c "$pymolproxy"

echo "$nanoscale -l $nanovis_port -c \"$nanovis\""
$nanoscale -l $nanovis_port -c "$nanovis" 
