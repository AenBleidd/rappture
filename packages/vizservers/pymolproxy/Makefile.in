
TARGETS =	pymolproxy pymolproxy2

CC =		@CC@
CC_SWITCHES =	$(CFLAGS) $(EXTRA_CFLAGS) $(DEFINES) $(INCLUDES)
CFLAGS =	@CFLAGS@ 
DEFINES =	-DSTANDALONE \
		-DSVN_VERSION=\"$(SVN_VERSION)\" \
		-DSTATSDIR=\"$(STATSDIR)\" \
		-DLOGDIR=\"$(LOGDIR)\" 
EXTRA_CFLAGS =	-Wall 
INCLUDES =	$(TCL_INC_SPEC) -I$(srcdir)
TCL_INC_SPEC =	@TCL_INC_SPEC@
TCL_LIB_SPEC =	@TCL_LIB_SPEC@

bindir =	@bindir@
datadir =	@datadir@
datarootdir =	@datarootdir@
exec_prefix =	@exec_prefix@
includedir =	@includedir@
libdir =	@libdir@
mandir =	@mandir@
prefix =	@prefix@
srcdir =	@srcdir@

INSTALL =	@INSTALL@
MKDIR_P =	@MKDIR_P@
VPATH =		$(srcdir)

SVN_VERSION	= $(shell svnversion $(srcdir))
STATSDIR	= @STATSDIR@
LOGDIR		= @LOGDIR@

.PHONY: all install clean distclean

FILES =		pymolproxy pymolproxy2 
PROXY_OBJS =	pymolproxy.o md5.o
PROXY2_OBJS =	pymolproxy2.o md5.o 
LIBS =		$(TCL_LIB_SPEC) \
		-Wl,-rpath,$(libdir) 

SCRIPTS		= $(srcdir)/scripts/box.py

all: $(TARGETS)

pymolproxy: $(PROXY_OBJS) 
	$(CC) $(CC_SWITCHES) -o $@ $^ $(LIBS)

pymolproxy2: $(PROXY2_OBJS) 
	$(CC) $(CC_SWITCHES) -o $@ $^ $(LIBS) -lpthread

.c.o:
	$(CC) $(CC_SWITCHES) -o $@ -c $<

install: install-pymolproxy install-scripts

install-pymolproxy: pymolproxy pymolproxy2
	$(MKDIR_P) -m 0755 $(bindir)
	for i in $(FILES) ; do \
	    $(INSTALL) -m 0555 $$i $(bindir) ; \
	done

install-scripts:
	$(MKDIR_P) -m 0755 $(libdir)/pymol/rappture
	for i in $(SCRIPTS) ; do \
	    $(INSTALL) -m 0555 $$i $(libdir)/pymol/rappture; \
	done

clean:
	$(RM) a.out *.o *~ core* $(TARGETS) *.log *.tmp logfile* .deps/*.d

distclean: clean
	$(RM) Makefile pymol
